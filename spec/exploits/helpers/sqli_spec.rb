require 'spec_helper'
require 'ronin/exploits/helpers/sqli'

describe Exploits::Helpers::Sqli do
  subject do
    Object.new.extend(Exploits::Helpers::Sqli)
  end

  describe "sql_compress" do
    it "should replace ';\\n' with a ';'" do
      sql = "DECLARE x NUMBER;\nBEGIN"
      expected = "DECLARE x NUMBER;BEGIN"

      subject.sql_compress(sql).should == expected
    end

    it "should replace remaining new-lines with a ' '" do
      sql = "DECLARE x NUMBER;\nBEGIN\n\nEND;"
      expected = "DECLARE x NUMBER;BEGIN END;"

      subject.sql_compress(sql).should == expected
    end

    it "should remove white-space characters >= 2 chars" do
      sql = "DECLARE x NUMBER;\nBEGIN\n  SELECT;\nEND;"
      expected = "DECLARE x NUMBER;BEGIN SELECT;END;"

      subject.sql_compress(sql).should == expected
    end
  end
end
